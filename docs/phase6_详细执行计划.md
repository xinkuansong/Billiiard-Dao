# 详细执行计划

## 一、页面结构与交互流程

### 页面清单

```
App页面结构
│
├── 启动页 (LaunchScreen)
│   └── 品牌Logo展示 → 自动跳转首页
│
├── 引导页 (Onboarding) [首次启动]
│   ├── 第1页: 欢迎 + App介绍
│   ├── 第2页: 核心功能展示
│   ├── 第3页: 开始使用按钮
│   └── → 跳转首页
│
├── 首页 (Home)
│   ├── 顶部: 用户等级 + 经验值
│   ├── 快捷入口: 继续学习 / 快速练习
│   ├── 课程进度卡片
│   ├── 今日统计
│   └── 底部Tab: 首页 | 课程 | 训练 | 统计 | 设置
│
├── 课程页 (Course)
│   ├── 课程列表
│   │   ├── 免费课程区 (L1-L3)
│   │   ├── 基础课程区 (L4-L8) [锁定/解锁]
│   │   ├── 进阶课程区 (L9-L14) [锁定]
│   │   └── 高级课程区 (L15-L18) [锁定]
│   │
│   └── 课程详情页
│       ├── 课程标题 + 简介
│       ├── 学习目标
│       ├── 预计时长
│       ├── 开始学习按钮
│       └── → 进入课程场景
│
├── 课程场景 (LessonScene)
│   ├── 教学阶段
│   │   ├── 文字/图示讲解
│   │   ├── 动画演示
│   │   └── 下一步按钮
│   ├── 练习阶段
│   │   ├── 球台场景
│   │   ├── 任务提示
│   │   ├── 击球操作
│   │   └── 结果反馈
│   └── 完成阶段
│       ├── 得分统计
│       ├── 星级评价
│       └── 返回/下一课
│
├── 训练页 (Training)
│   ├── 训练场列表
│   │   ├── 瞄准训练场 [免费]
│   │   ├── 杆法训练场 [基础包]
│   │   ├── 翻袋训练场 [进阶包]
│   │   ├── K球训练场 [进阶包]
│   │   └── ...
│   │
│   └── 训练场详情
│       ├── 难度选择 (1-5星)
│       ├── 最佳记录
│       └── 开始训练
│
├── 训练场景 (TrainingScene)
│   ├── 球台 (可切换2D/3D视角)
│   ├── 任务目标显示
│   ├── 计分/计时
│   ├── 暂停菜单
│   └── 结算页面
│
├── 挑战页 (Challenge)
│   ├── 单球挑战
│   ├── 走位挑战
│   ├── 连击挑战 [V1.1]
│   └── 清台挑战 [V1.2]
│
├── 统计页 (Statistics)
│   ├── 总览数据
│   │   ├── 总练习时长
│   │   ├── 总进球数
│   │   └── 平均进球率
│   ├── 技能雷达图 [V1.2]
│   ├── 历史记录
│   └── 成就徽章
│
├── 设置页 (Settings)
│   ├── 游戏设置
│   │   ├── 音效开关
│   │   ├── 震动反馈
│   │   └── 辅助线显示
│   ├── 购买管理
│   │   ├── 已购内容
│   │   └── 恢复购买
│   ├── 关于
│   │   ├── 版本信息
│   │   ├── 隐私政策
│   │   └── 使用帮助
│   └── 反馈
│
└── 内购弹窗 (IAPSheet)
    ├── 课程包介绍
    ├── 价格显示
    ├── 购买按钮
    └── 恢复购买链接
```

---

## 二、击球交互详细设计

```
击球操作流程
│
├── 1. 瞄准阶段
│   ├── 手指触摸屏幕 → 显示瞄准线
│   ├── 拖动调整方向 → 瞄准线跟随
│   ├── 显示辅助信息:
│   │   ├── 假想球位置
│   │   ├── 进袋线(虚线)
│   │   ├── 分离角数值
│   │   └── 预测轨迹(可选)
│   └── 松开确认方向
│
├── 2. 打点选择
│   ├── 点击母球 → 显示打点面板
│   ├── 打点面板:
│   │   ├── 9宫格打点选择
│   │   ├── 当前打点高亮
│   │   ├── 杆法名称显示
│   │   └── 效果预览提示
│   └── 点击确认打点
│
├── 3. 力度控制
│   ├── 显示力度条
│   ├── 向后拖动 → 蓄力
│   │   ├── 力度条填充
│   │   ├── 球杆后拉动画
│   │   └── 力度数值显示
│   └── 松开 → 击球
│
├── 4. 击球执行
│   ├── 球杆前推动画
│   ├── 击球音效
│   ├── 球开始运动
│   ├── 相机可跟随母球(可选)
│   └── 等待球停止
│
└── 5. 结果判定
    ├── 检测进球
    │   ├── 进球 → 进袋音效 + 得分
    │   └── 未进 → 提示
    ├── 检测母球位置
    │   ├── 落袋 → 犯规处理
    │   └── 正常 → 继续
    └── 更新统计数据
```

---

## 三、相机控制详细设计

### 预设视角

| 视角 | 角度 | 距离 | 投影 | 用途 |
|------|------|------|------|------|
| 2D俯视 | 90° | 远 | 正交 | 走位规划、颗星计算 |
| 3D斜视 | 45° | 中 | 透视 | 日常练习 |
| 击球视角 | 15° | 近 | 透视 | 模拟真实击球 |
| 自由视角 | 任意 | 任意 | 透视 | 自由观察 |

### 手势控制

| 手势 | 功能 | 参数 |
|------|------|------|
| 单指拖动 | 环绕旋转 | 灵敏度可调 |
| 双指捏合 | 距离调整 | 范围1.5~5.0 |
| 双指上下滑 | 俯仰角度 | 范围10°~90° |
| 双击 | 切换预设视角 | 循环切换 |

### 代码结构

```swift
class CameraController {
    
    enum ViewMode {
        case topDown      // 2D俯视 (90°)
        case perspective  // 3D斜视 (45°)
        case shooting     // 击球视角 (15°)
        case free         // 自由视角
    }
    
    var currentMode: ViewMode = .perspective
    var distance: Float = 3.0
    var angle: Float = 45.0
    var rotation: Float = 0.0
    var focusPoint: SCNVector3
    
    func switchTo(_ mode: ViewMode, animated: Bool = true)
    func handlePan(_ gesture: UIPanGestureRecognizer)
    func handlePinch(_ gesture: UIPinchGestureRecognizer)
    func handleTwoFingerPan(_ delta: CGFloat)
}
```

---

## 四、课程内容详案

### L1: 认识台球

| 项目 | 内容 |
|------|------|
| 时长 | 5分钟 |
| 学习目标 | 了解中式八球基本规则 |
| 教学内容 | 球台介绍、球的分类、基本规则、术语介绍 |
| 练习任务 | 识别题：指出各类球（3题） |
| 通过条件 | 正确率≥80% |

### L2: 瞄准入门

| 项目 | 内容 |
|------|------|
| 时长 | 8分钟 |
| 学习目标 | 理解直球瞄准原理 |
| 教学内容 | 瞄准原理、瞄准线介绍、击球操作 |
| 练习任务 | 完成5个直球进袋 |
| 通过条件 | 进球≥3个 |

### L3: 第一次进球

| 项目 | 内容 |
|------|------|
| 时长 | 10分钟 |
| 学习目标 | 熟练直球击打 |
| 教学内容 | 复习瞄准、力度控制 |
| 练习任务 | 完成10个直球进袋 |
| 通过条件 | 累计进球≥10个 |

### L4: 角度球基础

| 项目 | 内容 |
|------|------|
| 时长 | 12分钟 |
| 学习目标 | 理解厚薄球概念，完成角度球 |
| 教学内容 | 厚薄球概念、瞄准点、假想球法、30°角度球 |
| 练习任务 | 5个30°球 + 5个45°球 |
| 通过条件 | 总进球率≥50% |

### L5: 打点入门

| 项目 | 内容 |
|------|------|
| 时长 | 12分钟 |
| 学习目标 | 理解打点对母球的影响 |
| 教学内容 | 打点系统、中杆、高杆、低杆 |
| 练习任务 | 各杆法练习 |
| 通过条件 | 每种杆法成功≥2次 |

### L6: 分离角原理

| 项目 | 内容 |
|------|------|
| 时长 | 10分钟 |
| 学习目标 | 理解分离角，预判母球走向 |
| 教学内容 | 分离角定义、公式、应用 |
| 练习任务 | 预测分离角 + 选择击球厚度 |
| 通过条件 | 正确率≥60% |

### L7: 左右塞基础

| 项目 | 内容 |
|------|------|
| 时长 | 12分钟 |
| 学习目标 | 理解塞球对库边反弹的影响 |
| 教学内容 | 塞球概念、库边影响、修正幅度 |
| 练习任务 | 左塞/右塞碰库练习 |
| 通过条件 | 完成所有练习 |

### L8: 单球走位

| 项目 | 内容 |
|------|------|
| 时长 | 15分钟 |
| 学习目标 | 综合运用杆法控制母球落点 |
| 教学内容 | 走位概念、走位规划、综合应用 |
| 练习任务 | 定点走位 + 两球连续 |
| 通过条件 | 走位成功≥3次 |

---

## 五、训练场关卡详案

### 瞄准训练场

| 难度 | 角度 | 距离 | 目标 | 评分 |
|------|------|------|------|------|
| ⭐ | 0° (直球) | 20-30cm | 进10球 | 进球数 |
| ⭐⭐ | 25-35° | 30-50cm | 进10球 | 进球数+用时 |
| ⭐⭐⭐ | 40-50° | 50-80cm | 进10球 | 进球数+用时 |
| ⭐⭐⭐⭐ | 55-65° | 60-100cm | 进10球 | 进球率 |
| ⭐⭐⭐⭐⭐ | 30-75°随机 | 40-120cm | 进15球 | 进球率+用时 |

### 杆法训练场

| 难度 | 场景 | 目标 | 评分 |
|------|------|------|------|
| ⭐ | 中杆定位 | 母球停在1球直径内 | 距离误差 |
| ⭐⭐ | 高杆跟进 | 母球前进到指定区域 | 区域命中 |
| ⭐⭐⭐ | 低杆拉回 | 母球后退到指定区域 | 区域命中 |
| ⭐⭐⭐⭐ | 塞球走位 | 利用塞球碰库走位 | 落点精度 |
| ⭐⭐⭐⭐⭐ | 复合杆法 | 高杆+塞/低杆+塞 | 综合评分 |

---

## 六、物理参数详表

```swift
struct PhysicsConstants {
    
    // 球台尺寸 (米)
    static let tableLength: Float = 2.54
    static let tableWidth: Float = 1.27
    static let pocketRadius: Float = 0.05
    
    // 球参数
    static let ballRadius: Float = 0.02858    // 57.15mm / 2
    static let ballMass: Float = 0.17         // 170g
    
    // 摩擦系数
    static let clothFriction: Float = 0.2
    static let cushionFriction: Float = 0.3
    static let ballFriction: Float = 0.05
    
    // 弹性系数
    static let cushionRestitution: Float = 0.85
    static let ballRestitution: Float = 0.95
    
    // 旋转参数
    static let maxTopSpin: Float = 1.0
    static let maxSideSpin: Float = 1.0
    static let spinDecayRate: Float = 0.98
    static let spinTransferRate: Float = 0.3
    static let englishCushionEffect: Float = 0.12
    
    // 速度参数
    static let maxVelocity: Float = 8.0
    static let minVelocity: Float = 0.5
    static let velocityDecay: Float = 0.995
    static let stopThreshold: Float = 0.01
}
```

---

## 七、音效与动画清单

### 音效

| 音效ID | 触发场景 | 文件 |
|--------|---------|------|
| cue_hit | 击球瞬间 | cue_hit.mp3 |
| ball_collision | 球间碰撞 | ball_collision.mp3 |
| cushion_hit | 碰库边 | cushion_hit.mp3 |
| pocket_drop | 进袋 | pocket_drop.mp3 |
| success | 任务成功 | success.mp3 |
| fail | 任务失败 | fail.mp3 |
| button_tap | 按钮点击 | button_tap.mp3 |
| level_up | 升级 | level_up.mp3 |

### 动画

| 动画 | 触发场景 | 持续时间 |
|------|---------|---------|
| 球杆后拉 | 蓄力时 | 跟随手势 |
| 球杆击球 | 松开击球 | 0.1秒 |
| 球进袋 | 进袋时 | 0.3秒 |
| 星级显示 | 完成关卡 | 0.5秒 |
| 视角切换 | 切换相机 | 0.5秒 |
| 数字跳动 | 得分增加 | 0.3秒 |

---

## 八、详细开发周计划

### 第1周：项目搭建

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 创建Xcode项目，配置项目结构 | 项目文件 |
| 2 | 创建目录结构，添加基础文件 | 目录完整 |
| 3 | 配置SwiftUI+SceneKit集成 | 场景可显示 |
| 4 | 创建球台基础模型 | 球台可见 |
| 5 | 创建球体模型+材质 | 球可见 |

### 第2周：场景完善

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 球台材质优化 | 真实材质 |
| 2 | 光照设置 | 良好光影 |
| 3 | 袋口实现 | 6个袋口 |
| 4 | 基础相机设置 | 可观察场景 |
| 5 | 场景整体调优 | 完整球台场景 |

### 第3周：基础物理

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 配置SceneKit物理世界 | 物理环境 |
| 2 | 球的物理体设置 | 球可碰撞 |
| 3 | 库边碰撞检测 | 球可反弹 |
| 4 | 袋口检测 | 进球检测 |
| 5 | 速度衰减实现 | 球可停止 |

### 第4周：击球交互

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 触摸瞄准交互 | 可拖动瞄准 |
| 2 | 瞄准线渲染 | 显示瞄准线 |
| 3 | 力度控制UI | 力度条可用 |
| 4 | 击球触发逻辑 | 可击球 |
| 5 | **里程碑M1验收** | 完整击球体验 |

### 第5周：旋转系统(上)

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 打点选择UI设计 | 打点面板 |
| 2 | 打点选择交互实现 | 可选择打点 |
| 3 | 顺旋实现（高杆） | 高杆效果 |
| 4 | 逆旋实现（低杆） | 低杆效果 |
| 5 | 旋转效果调试 | 基础旋转可用 |

### 第6周：旋转系统(下)

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 左塞实现 | 左塞效果 |
| 2 | 右塞实现 | 右塞效果 |
| 3 | 复合旋转 | 组合杆法 |
| 4 | 旋转传递 | 碰撞传递旋转 |
| 5 | 旋转衰减 | 完整旋转系统 |

### 第7周：库边与瞄准

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 库边旋转修正算法 | 塞球反弹 |
| 2 | 库边修正调试 | 效果正确 |
| 3 | 假想球显示 | 假想球可见 |
| 4 | 分离角计算显示 | 分离角数值 |
| 5 | 轨迹预测（可选） | 轨迹预览 |

### 第8周：相机系统

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 预设视角实现 | 4种视角 |
| 2 | 单指旋转手势 | 环绕旋转 |
| 3 | 双指缩放手势 | 距离调整 |
| 4 | 视角切换动画 | 平滑过渡 |
| 5 | **里程碑M2验收** | 完整物理+瞄准+相机 |

### 第9周：课程框架

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 课程数据模型设计 | 数据模型 |
| 2 | 课程列表页面 | 列表UI |
| 3 | 课程详情页面 | 详情UI |
| 4 | 课程场景框架 | 场景框架 |
| 5 | 进度保存逻辑 | 进度可保存 |

### 第10周：L1-L4实现

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | L1课程内容 | L1可用 |
| 2 | L2课程内容 | L2可用 |
| 3 | L3课程内容 | L3可用 |
| 4 | L4课程内容 | L4可用 |
| 5 | 课程流程调试 | 流程顺畅 |

### 第11周：L5-L8实现

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | L5课程内容 | L5可用 |
| 2 | L6课程内容 | L6可用 |
| 3 | L7课程内容 | L7可用 |
| 4 | L8课程内容 | L8可用 |
| 5 | 整体课程调试 | 8课完整 |

### 第12周：训练场实现

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 训练场框架 | 框架完成 |
| 2 | 瞄准训练场(1-3星) | 基础瞄准 |
| 3 | 瞄准训练场(4-5星) | 完整瞄准 |
| 4 | 杆法训练场 | 杆法训练 |
| 5 | **里程碑M3验收** | 课程+训练场完整 |

### 第13周：挑战模式

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 挑战模式框架 | 框架完成 |
| 2 | 单球挑战实现 | 单球可用 |
| 3 | 走位挑战实现 | 走位可用 |
| 4 | 计分系统 | 计分完成 |
| 5 | 排行榜(本地) | 排行可用 |

### 第14周：数据统计

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 统计数据模型 | 数据模型 |
| 2 | 数据收集逻辑 | 数据可收集 |
| 3 | 统计页面UI | 统计页面 |
| 4 | 图表展示 | 图表可见 |
| 5 | 数据持久化 | 数据可保存 |

### 第15周：内购系统

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | StoreKit 2配置 | 配置完成 |
| 2 | 产品列表获取 | 产品可获取 |
| 3 | 购买流程实现 | 购买可用 |
| 4 | 恢复购买实现 | 恢复可用 |
| 5 | 沙盒测试 | 测试通过 |

### 第16周：UI完善

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 启动页设计 | 启动页 |
| 2 | 引导页实现 | 引导页 |
| 3 | 设置页完善 | 设置页 |
| 4 | 整体UI调优 | UI完整 |
| 5 | **里程碑M4验收** | 功能完整 |

### 第17周：物理调优

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1-2 | 旋转参数调优 | 手感优化 |
| 3-4 | 碰撞参数调优 | 真实感提升 |
| 5 | 整体物理验收 | 物理满意 |

### 第18周：性能优化

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | 性能分析 | 瓶颈识别 |
| 2 | 渲染优化 | 帧率稳定 |
| 3 | 内存优化 | 无泄漏 |
| 4-5 | 全机型测试 | 兼容性OK |

### 第19周：TestFlight测试

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | TestFlight配置 | 配置完成 |
| 2 | 内部测试 | 反馈收集 |
| 3-4 | Bug修复 | Bug清零 |
| 5 | 回归测试 | 测试通过 |

### 第20周：上架准备

| 天 | 任务 | 交付物 |
|---|------|--------|
| 1 | App图标设计 | 图标完成 |
| 2 | 截图准备 | 截图完成 |
| 3 | 描述文案 | 文案完成 |
| 4 | App Store配置 | 配置完成 |
| 5 | **提交审核M5** | 审核中 |

---

## 九、测试计划

### 功能测试用例

| 模块 | 测试项 | 预期结果 |
|------|--------|---------|
| 物理引擎 | 直球碰撞 | 方向正确，速度衰减正常 |
| 物理引擎 | 角度球碰撞 | 分离角正确 |
| 物理引擎 | 高杆效果 | 母球前进 |
| 物理引擎 | 低杆效果 | 母球后退 |
| 物理引擎 | 塞球库边 | 反弹角度正确修正 |
| 相机 | 视角切换 | 平滑过渡，无卡顿 |
| 相机 | 手势控制 | 响应灵敏，无延迟 |
| 课程 | 课程解锁 | 付费后正确解锁 |
| 课程 | 进度保存 | 退出后进度保留 |
| 内购 | 购买流程 | 正常完成购买 |
| 内购 | 恢复购买 | 正确恢复已购内容 |
| 数据 | 统计准确 | 进球率计算正确 |
| 数据 | 持久化 | 重启后数据保留 |

### 性能测试标准

| 指标 | 标准 |
|------|------|
| 启动时间 | <3秒 |
| 帧率 | 稳定60fps |
| 内存占用 | <200MB |
| 包体积 | <100MB |
| 电池消耗 | 中等 |

---

## 十、风险与应对

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|---------|
| 物理引擎调试困难 | 高 | 延期2-4周 | 预留buffer，参考开源 |
| 旋转效果不真实 | 中 | 体验差 | 参考物理公式，反复调试 |
| 性能问题 | 中 | 老设备卡顿 | 优化渲染，降级方案 |
| App Store被拒 | 低 | 延期1-2周 | 严格按规范开发 |
| 内购审核问题 | 低 | 延期1周 | 沙盒充分测试 |

# 训练场功能拆解方法（用户操作 × 系统能力 × 状态规则）

适用范围：仅聚焦“训练场（TrainingScene）”的功能与体验设计。  
目标：把体验讨论变成**可实现、可验收、可扩展**的规格，方便你拆任务、写 Issue、推进开发。

---

## 为什么“用户操作 + 系统功能”的拆解方向是对的

把训练场拆成两类：

- **用户操作（Input / Intent）**：用户想做什么（调方向、选打点、拉力度、切视角……）
- **系统功能（Capability）**：系统如何响应（渲染辅助线、执行物理、判定得分、给诊断、记录数据……）

优点：

- **防跑偏**：不会把训练场做成“能打的模拟器”，而是围绕训练闭环设计。
- **便于实现**：每个系统功能都能映射到代码模块/文件。
- **便于验收**：每个操作都能写出“预期反馈”和“通过标准”。

局限（两层拆解常见问题）：

- 同一个操作在不同阶段应该怎么表现？（例如球在动时还能不能切相机/出杆？）
- 手势冲突如何裁决？（瞄准 vs 相机 vs 蓄力）
- 默认弱辅助如何“既不打扰、又不让新手卡死”？

因此更推荐在两层之外补一层“规则胶水”。

---

## 最推荐：三层模型（比两层更稳、更可落地）

三层模型 = **A 用户操作** + **B 系统能力** + **C 状态机与规则**

### A) 用户操作（User Intent / Input）

只描述“用户想做什么”，不掺实现细节：

- 调整视角：2D 俯视 / 3D 斜视 / 击球视角（循环切换）
- 调整瞄准方向
- 选择打点/杆法：高低杆、左右塞、复合
- 调整力度并出杆
- 暂停 / 重开 / 退出
- 查看复盘 / 下一杆 / 再来一次
- 切换辅助强度：弱 / 中 / 强（训练内一键）

### B) 系统能力（System Capability）

描述系统必须提供的能力模块（建议能映射到代码模块）：

- **关卡与摆球**：加载关卡、自动复位、随机扰动（可控难度）
- **相机控制**：预设视角切换、双指交互、锁定/跟随策略
- **瞄准与辅助渲染**：瞄准线、假想球、进袋线、分离角、目标区
- **击球参数 → 物理执行**：方向/力度/打点映射到初始速度与角速度
- **回合结束判定**：球静止、进袋、犯规（若有规则）
- **目标判定与评分**：进球/落点误差/稳定性/效率（按训练类型加权）
- **诊断与建议**：失败原因标签（即时）+ 下一步建议（结算）
- **复盘**：至少支持 2D 俯视的落点误差展示（目标点/实际点/误差距离）
- **数据记录**：每杆记录、每局汇总、最佳记录、趋势（本地）

### C) 状态机与规则（State & Rules）——“胶水层”

这一层回答：**某个操作在某个阶段是否可用？用后系统应做什么？**

建议状态机（训练场通用）：

- `Ready`：准备/摆球完成，等待用户开始瞄准
- `Aiming`：可调方向、可调相机、可调辅助强度、可开打点盘
- `Charging`：仅允许力度输入；相机锁定；瞄准可小幅微调（可选）
- `Stroke`：出杆瞬间（短暂状态，用于撤销窗/动画/锁输入）
- `Moving`：球运动中；禁止出杆；相机建议锁定或弱跟随
- `Result`：本杆结果/诊断/复盘；允许下一杆/再来一次
- `Paused`：暂停菜单（继续/重开/退出/设置）

典型规则示例（用来避免误触与体验抖动）：

- **Charging 锁相机**：进入 `Charging` 后双指相机操作不生效（防抖）
- **Moving 禁止出杆**：球未停稳前不允许再次击球
- **弱辅助默认**：默认仅显示最基础信息；但允许训练内一键增强到中/强
- **失败触发教练提示**：同一杆位连续失败 2 次，弹出“一句话建议 + 可执行动作”
- **每杆必产出**：成功/失败 + 原因标签 +（可选）误差数值（用于学习闭环）

---

## 如果你只想保留“两层拆解”，请用这个增强模板补齐可落地信息

对每一条“用户操作”，强制补齐 4 个字段：

1) **触发条件（状态）**：在哪些状态可用/不可用  
2) **系统响应**：UI/物理/数据分别做什么  
3) **反馈**：视觉/触觉/声音/文案（保持一致性）  
4) **验收标准**：一句话可测（能写成测试用例）

示例模板（建议你后续写 Issue 就照抄）：

```text
用户操作：
触发条件（状态）：
系统响应：
反馈：
验收标准：
```

---

## 一个更“产品化”的替代拆解视角：按“任务（Task）/训练目标”拆

当你开始扩关卡、做成长体系时，“按任务拆”更直观，因为训练场本质是完成训练任务，而不是堆功能。

示例（建议你把训练关卡都归到这三类任务中）：

- **命中任务（瞄准）**：目标 = 进球/进指定袋  
  - 输入：瞄准 →（可选打点）→ 力度 → 出杆  
  - 系统：判定命中 → 失败原因标签 → 推荐下一球型练习

- **控位任务（走位）**：目标 = 进球 + 白球落入目标区  
  - 输入：观察目标区 → 瞄准 → 打点/杆法 → 力度 → 出杆  
  - 系统：落点误差计算 → 2D 复盘 → 建议（例如“力度降到 70% 再试”）

- **球行为任务（杆法）**：目标 = 跟进/拉回/吃库后落点达到要求  
  - 输入：打点/塞量选择 → 力度 → 出杆  
  - 系统：行为是否达成 → 误差与稳定性 → 下一杆建议

这套任务视角可以和“三层模型”同时存在：  
任务定义“练什么”，三层模型定义“怎么交互、怎么实现、怎么验收”。

---

## 你当前训练场 V1 约束（用于所有取舍的“裁判”）

根据你给的约束，训练场 V1 的关键裁判可以写成：

- **范围**：瞄准 + 杆法 + 走位都要（杆法与走位必须在同一训练体系内闭环）
- **辅助**：默认弱；训练内可一键切换弱/中/强；连续失败触发教练提示
- **输入**：训练时必须双手（更适合清晰分区输入：瞄准区/力度控件/打点盘）
- **节奏**：每局按目标击球数结算（例如 N=10/15/20）

---

## 推荐你用这份拆解推进实现的方式（最少返工）

1) 先做一个 **纵切闭环**：开始一局 N 杆 → 能出杆 → 能判定本杆 → 能结算 → 能再来一次  
2) 在同一骨架上加“三类任务”各 1 个关卡模板（先做 1 星）  
3) 再加辅助档位与教练提示（默认弱，但不让用户卡死）  
4) 最后把复盘与诊断做“轻量但高频”（每杆 1 标签、结算 1–2 建议、2D 落点误差）

---

## 附：训练场 PRD/Issue 的最小写法（复制即可用）

```text
目标（本任务解决什么训练问题）：
用户操作（Intent）：
系统能力（Capability）：
状态机与规则（State & Rules）：
反馈（视觉/触觉/声音/文案）：
数据记录（本杆/本局需要存什么）：
验收标准（可测的一句话）：
```


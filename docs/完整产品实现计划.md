# 台球训练App - 完整产品实现计划

## 文档概述

本文档基于现有的产品定位、技术方案和代码库现状，制定一个从当前状态到App Store上架的完整、可执行的产品实现计划。

**制定日期**: 2026-01-31
**目标**: V1.0 MVP版本上架App Store
**预计周期**: 12-14周（约3-3.5个月）

---

## 一、当前项目状态评估

### 1.1 已完成模块 ✅

| 模块 | 完成度 | 说明 |
|------|--------|------|
| **项目架构** | 100% | SwiftUI + SceneKit + SwiftData 架构完整 |
| **基础UI框架** | 90% | Tab导航、引导页、主要页面框架已完成 |
| **物理引擎核心** | 85% | 碰撞、旋转、库边反弹基本实现 |
| **场景渲染** | 90% | 球台、球体、相机系统已完成 |
| **瞄准系统** | 80% | 瞄准线、假想球、分离角计算已实现 |
| **颗星公式** | 90% | 一库/二库/三库颗星计算完成 |
| **音效系统** | 80% | 基础音效与震动反馈已实现 |
| **数据模型** | 90% | SwiftData模型定义完整 |
| **训练场框架** | 70% | 训练场景与ViewModel基本完成 |

### 1.2 待完成模块 ⚠️

| 模块 | 优先级 | 说明 |
|------|--------|------|
| **课程系统** | P0 | 课程内容与学习流程需完整实现 |
| **内购系统** | P0 | StoreKit 2集成与测试 |
| **数据统计** | P1 | 统计页面与UserStatistics数据打通 |
| **物理调优** | P0 | 旋转效果、碰撞参数需精细调试 |
| **轨迹预测UI** | P1 | 轨迹预测可视化 |
| **性能优化** | P1 | 帧率稳定性、内存优化 |
| **App Store素材** | P0 | 图标、截图、文案准备 |

### 1.3 关键技术债务

1. **课程与训练数据未打通**: 训练结果未正确更新UserStatistics
2. **进袋事件链不完整**: 球进袋后的处理逻辑有TODO标记
3. **内购功能缺失**: 课程解锁逻辑未实现
4. **物理参数未调优**: 需要大量测试调整手感
5. **障碍球检测缺失**: 瞄准时未检测障碍球遮挡

---

## 二、V1.0 MVP功能范围确认

### 2.1 核心功能（必须完成）

#### 物理引擎 ✅ (需调优)
- [x] 基础碰撞检测
- [x] 旋转系统（高杆、低杆、左右塞）
- [x] 库边反弹与塞修正
- [ ] 参数精细调优（手感优化）

#### 相机系统 ✅
- [x] 2D/3D视角切换
- [x] 手势控制（拖拽、缩放、旋转）
- [x] 预设视角

#### 瞄准系统 ✅ (需完善)
- [x] 瞄准线显示
- [x] 假想球显示
- [x] 分离角计算
- [ ] 障碍球检测
- [ ] 轨迹预测UI优化

#### 课程系统 ⚠️ (需完成)
- [ ] L1-L3 免费课程内容实现
- [ ] L4-L8 基础课程内容实现
- [ ] 课程学习流程
- [ ] 课程进度保存与同步
- [ ] 课程完成判定与评分

#### 训练场 ✅ (需完善)
- [x] 瞄准训练场框架
- [x] 杆法训练场框架
- [ ] 训练数据与统计打通
- [ ] 难度曲线调整

#### 挑战模式 ⚠️ (可选P1)
- [ ] 单球挑战
- [ ] 走位挑战

#### 数据统计 ⚠️ (需完成)
- [x] 统计页面UI
- [ ] 数据收集逻辑完善
- [ ] 与训练/课程数据打通
- [ ] 图表数据准确性验证

#### 内购系统 ❌ (需完成)
- [ ] StoreKit 2集成
- [ ] 产品配置（基础课程包¥18）
- [ ] 购买流程实现
- [ ] 恢复购买功能
- [ ] 课程解锁逻辑
- [ ] 沙盒测试

#### 设置系统 ✅
- [x] 游戏设置（音效、震动、辅助线）
- [ ] 恢复购买入口
- [x] 帮助与反馈

### 2.2 V1.0 功能裁剪建议

为确保按时上架，建议将以下功能延后到V1.1：

| 功能 | 原计划 | 调整建议 | 理由 |
|------|--------|---------|------|
| 挑战模式 | V1.0 | → V1.1 | 非核心功能，可延后 |
| 轨迹预测UI | V1.0 | → V1.1 | 已有基础瞄准，可优化后再上 |
| 技能雷达图 | V1.0 | → V1.2 | 文档已标注V1.2 |
| 障碍球检测 | V1.0 | → V1.1 | 影响有限，可延后 |

---

## 三、详细执行计划（12周）

### 阶段1: 课程系统实现（第1-3周）

#### 第1周：课程框架与L1-L3

**目标**: 完成免费课程内容实现

| 天 | 任务 | 交付物 | 负责人 |
|----|------|--------|--------|
| 1 | 设计课程数据结构与JSON配置 | 课程配置文件 | 开发 |
| 2 | 实现课程详情页（LessonDetailView） | 详情页UI | 开发 |
| 3 | 实现课程学习场景（LessonSceneView） | 学习场景框架 | 开发 |
| 4 | L1课程内容实现（认识台球） | L1可学习 | 开发 |
| 5 | L2-L3课程内容实现 | L2-L3可学习 | 开发 |

**验收标准**:
- 用户可以从课程列表进入L1-L3
- 课程内容完整展示（文字、图示、动画）
- 练习任务可以完成
- 课程进度正确保存

#### 第2周：L4-L6基础课程

| 天 | 任务 | 交付物 |
|----|------|--------|
| 1 | L4课程内容（角度球基础） | L4可学习 |
| 2 | L5课程内容（打点入门） | L5可学习 |
| 3 | L6课程内容（分离角原理） | L6可学习 |
| 4 | 课程解锁逻辑实现 | 付费课程锁定 |
| 5 | 课程评分与星级系统 | 评分可用 |

**验收标准**:
- L4-L6内容完整
- 未购买时显示锁定状态
- 课程完成后显示星级评价

#### 第3周：L7-L8与课程完善

| 天 | 任务 | 交付物 |
|----|------|--------|
| 1 | L7课程内容（左右塞基础） | L7可学习 |
| 2 | L8课程内容（单球走位） | L8可学习 |
| 3 | 课程进度与统计数据打通 | 数据同步 |
| 4 | 课程流程优化与Bug修复 | 流程顺畅 |
| 5 | **里程碑M1验收**: 8课完整可学习 | M1完成 |

---

### 阶段2: 内购系统实现（第4-5周）

#### 第4周：StoreKit 2集成

| 天 | 任务 | 交付物 |
|----|------|--------|
| 1 | App Store Connect配置产品 | 产品配置完成 |
| 2 | StoreKit 2代码集成 | IAPService实现 |
| 3 | 产品列表获取与展示 | 产品可展示 |
| 4 | 购买流程实现 | 购买可用 |
| 5 | 购买状态持久化 | 状态可保存 |

**关键代码模块**:
```swift
// Services/IAPService.swift
class IAPService: ObservableObject {
    @Published var products: [Product] = []
    @Published var purchasedProductIDs: Set<String> = []

    func loadProducts() async
    func purchase(_ product: Product) async throws
    func restorePurchases() async
    func isPurchased(_ productID: String) -> Bool
}
```

#### 第5周：内购完善与测试

| 天 | 任务 | 交付物 |
|----|------|--------|
| 1 | 恢复购买功能实现 | 恢复购买可用 |
| 2 | 课程解锁逻辑集成 | 购买后解锁 |
| 3 | 内购UI优化（购买弹窗） | UI完善 |
| 4 | 沙盒环境测试 | 测试通过 |
| 5 | **里程碑M2验收**: 内购系统完整可用 | M2完成 |

**验收标准**:
- 沙盒环境可以成功购买
- 购买后课程正确解锁
- 恢复购买功能正常
- 购买失败有正确提示

---

### 阶段3: 数据统计与训练完善（第6-7周）

#### 第6周：数据统计打通

| 天 | 任务 | 交付物 |
|----|------|--------|
| 1 | 训练结果保存逻辑完善 | 数据可保存 |
| 2 | UserStatistics更新逻辑 | 统计数据准确 |
| 3 | 统计页面数据绑定 | 统计页可用 |
| 4 | 按角度/杆法统计实现 | 详细统计 |
| 5 | 历史记录展示 | 历史可查看 |

**关键逻辑**:
- TrainingViewModel结束时调用AppState.saveTrainingSession
- UserStatistics正确累加各项数据
- 统计页面实时反映最新数据

#### 第7周：训练场完善

| 天 | 任务 | 交付物 |
|----|------|--------|
| 1 | 瞄准训练场5星难度完善 | 难度完整 |
| 2 | 杆法训练场5星难度完善 | 难度完整 |
| 3 | 训练结果星级算法调优 | 算法合理 |
| 4 | 训练场UI优化 | UI完善 |
| 5 | **里程碑M3验收**: 训练与统计完整 | M3完成 |

---

### 阶段4: 物理调优与性能优化（第8-9周）

#### 第8周：物理参数调优

| 天 | 任务 | 交付物 |
|----|------|--------|
| 1-2 | 旋转效果调优（高杆/低杆） | 手感优化 |
| 3 | 塞球库边反弹调优 | 反弹准确 |
| 4 | 碰撞参数调优 | 碰撞真实 |
| 5 | 整体物理验收测试 | 物理满意 |

**调优重点**:
- 高杆母球前进距离合理
- 低杆母球后退距离合理
- 塞球库边角度修正准确
- 球速衰减自然

#### 第9周：性能优化

| 天 | 任务 | 交付物 |
|----|------|--------|
| 1 | 性能分析（Instruments） | 瓶颈识别 |
| 2 | 渲染优化（帧率稳定） | 60fps稳定 |
| 3 | 内存优化（无泄漏） | 内存正常 |
| 4 | 全机型测试（SE/14/15） | 兼容性OK |
| 5 | **里程碑M4验收**: 性能达标 | M4完成 |

**性能标准**:
- 启动时间 < 3秒
- 游戏场景稳定60fps
- 内存占用 < 200MB
- 无明显卡顿或崩溃

---

### 阶段5: UI完善与测试（第10-11周）

#### 第10周：UI完善

| 天 | 任务 | 交付物 |
|----|------|--------|
| 1 | 启动页优化 | 启动页完善 |
| 2 | 引导页优化 | 引导页完善 |
| 3 | 整体UI一致性检查 | UI统一 |
| 4 | 深色模式适配检查 | 深色模式OK |
| 5 | 动态字体适配检查 | 字体适配OK |

#### 第11周：功能测试

| 天 | 任务 | 交付物 |
|----|------|--------|
| 1 | 课程系统完整测试 | 测试报告 |
| 2 | 训练系统完整测试 | 测试报告 |
| 3 | 内购系统完整测试 | 测试报告 |
| 4 | 数据统计完整测试 | 测试报告 |
| 5 | Bug修复与回归测试 | Bug清零 |

**测试用例**: 参考phase6文档第九节

---

### 阶段6: TestFlight与上架（第12周）

#### 第12周：上架准备

| 天 | 任务 | 交付物 |
|----|------|--------|
| 1 | App图标设计与配置 | 图标完成 |
| 2 | 截图准备（5-10张） | 截图完成 |
| 3 | App Store文案撰写 | 文案完成 |
| 4 | 隐私政策页面上线 | 隐私政策URL |
| 5 | **提交审核M5** | 审核中 |

**上架素材清单**:
- [ ] App图标 1024x1024
- [ ] 6.7" 截图 5-10张
- [ ] 6.5" 截图 5-10张
- [ ] 5.5" 截图 5-10张
- [ ] App名称（30字符内）
- [ ] 副标题（30字符内）
- [ ] 描述文案（4000字符内）
- [ ] 关键词（100字符内）
- [ ] 隐私政策URL
- [ ] 支持URL

---

## 四、关键里程碑与验收标准

| 里程碑 | 时间 | 验收标准 |
|--------|------|---------|
| **M1: 课程系统完成** | 第3周 | L1-L8全部可学习，进度正确保存，评分系统可用 |
| **M2: 内购系统完成** | 第5周 | 沙盒购买成功，课程正确解锁，恢复购买可用 |
| **M3: 训练统计完成** | 第7周 | 训练数据正确保存，统计页面数据准确，历史可查 |
| **M4: 性能达标** | 第9周 | 60fps稳定，内存正常，全机型兼容 |
| **M5: 提交审核** | 第12周 | 所有功能测试通过，上架素材完整，提交审核 |

---

## 五、资源需求与分工

### 5.1 人力资源

| 角色 | 工作量 | 主要职责 |
|------|--------|---------|
| **iOS开发** | 全职12周 | 核心功能开发、物理调优、性能优化 |
| **UI设计** | 兼职2周 | App图标、截图、引导页优化 |
| **测试** | 兼职2周 | 功能测试、性能测试、兼容性测试 |
| **产品** | 兼职全程 | 需求确认、验收、文案撰写 |

### 5.2 工具与服务

| 工具/服务 | 用途 | 费用 |
|----------|------|------|
| Apple Developer | 开发者账号 | $99/年 |
| Xcode | 开发工具 | 免费 |
| TestFlight | 内测分发 | 免费 |
| GitHub | 代码托管 | 免费 |
| GitHub Pages | 隐私政策托管 | 免费 |

---

## 六、风险管理

### 6.1 技术风险

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|---------|
| **物理调优困难** | 高 | 延期1-2周 | 预留buffer时间，参考真实台球视频 |
| **内购审核问题** | 中 | 延期1周 | 严格按Apple规范，沙盒充分测试 |
| **性能问题** | 中 | 用户体验差 | 提前性能测试，优化渲染 |
| **课程内容不足** | 低 | 用户留存低 | 确保课程质量，收集用户反馈 |

### 6.2 进度风险

| 风险 | 应对措施 |
|------|---------|
| 开发进度延期 | 每周检查进度，及时调整计划 |
| 功能范围蔓延 | 严格控制V1.0范围，延后非核心功能 |
| 测试时间不足 | 预留2周测试时间，提前发现问题 |

### 6.3 应急预案

如果进度严重延期（>2周），启动应急预案：

**方案A: 功能裁剪**
- 延后挑战模式到V1.1
- 延后轨迹预测UI到V1.1
- 简化统计页面功能

**方案B: 延长周期**
- 延长2周到14周总周期
- 增加测试时间
- 确保质量不降低

---

## 七、质量保证

### 7.1 代码质量

- [ ] 代码审查（每周）
- [ ] 单元测试覆盖核心逻辑
- [ ] 无编译警告
- [ ] 无内存泄漏
- [ ] 符合Swift代码规范

### 7.2 功能质量

- [ ] 所有P0功能完整可用
- [ ] 无阻塞性Bug
- [ ] 用户流程顺畅
- [ ] 错误提示友好
- [ ] 性能达标

### 7.3 用户体验

- [ ] UI一致性
- [ ] 交互流畅
- [ ] 反馈及时
- [ ] 引导清晰
- [ ] 深色模式适配

---

## 八、上架后运营计划

### 8.1 V1.0上架后（第1-2周）

- 监控崩溃率（目标<0.5%）
- 收集用户反馈
- 监控关键指标（次日留存、付费转化）
- 准备V1.1需求

### 8.2 V1.1迭代（上架后4-6周）

**新增功能**:
- 进阶课程包（L9-L14）
- 翻袋训练场
- K球训练场
- 颗星公式可视化
- 每日一练系统
- 挑战模式

### 8.3 关键指标监控

| 指标 | V1.0目标 | V1.1目标 |
|------|---------|---------|
| App Store评分 | ≥4.0 | ≥4.3 |
| 次日留存率 | ≥30% | ≥35% |
| 7日留存率 | ≥15% | ≥18% |
| 付费转化率 | ≥3% | ≥4% |
| 月活用户 | 500+ | 2000+ |

---

## 九、沟通与协作

### 9.1 会议机制

| 会议 | 频率 | 参与人 | 目的 |
|------|------|--------|------|
| 每日站会 | 每天15分钟 | 开发团队 | 同步进度、识别阻塞 |
| 周会 | 每周1小时 | 全员 | 里程碑检查、风险评估 |
| 里程碑评审 | 每个里程碑 | 全员 | 验收交付物、调整计划 |

### 9.2 文档管理

- 代码托管: GitHub
- 文档管理: docs目录
- 任务跟踪: GitHub Issues
- 设计稿: Figma（如需要）

---

## 十、成功标准

### 10.1 V1.0上架成功标准

- [ ] 通过App Store审核
- [ ] 无阻塞性Bug
- [ ] 性能达标（60fps，<200MB内存）
- [ ] 内购功能正常
- [ ] 用户可完整学习L1-L8课程
- [ ] 训练场可正常使用
- [ ] 数据统计准确

### 10.2 用户价值交付标准

- [ ] 初学者可以通过课程学会基础瞄准
- [ ] 用户可以通过训练场提升技能
- [ ] 物理引擎真实度达到80%以上
- [ ] 用户愿意付费购买课程包
- [ ] 用户愿意推荐给朋友

---

## 十一、下一步行动

### 立即开始（本周）

1. **确认计划**: 与团队评审本计划，确认可行性
2. **环境准备**: 确保Xcode、Apple Developer账号就绪
3. **任务分解**: 将第1周任务分解到每日
4. **开始开发**: 启动第1周第1天任务

### 第1周具体任务

**Day 1**:
- 设计课程数据结构（Course、Lesson、LessonStep）
- 创建课程JSON配置文件格式
- 实现课程数据加载逻辑

**Day 2**:
- 创建LessonDetailView
- 实现课程详情页UI
- 添加"开始学习"按钮

**Day 3**:
- 创建LessonSceneView
- 实现课程学习场景框架
- 添加教学阶段/练习阶段切换

**Day 4**:
- 实现L1课程内容（认识台球）
- 添加规则介绍、术语讲解
- 实现识别题练习

**Day 5**:
- 实现L2课程内容（瞄准入门）
- 实现L3课程内容（第一次进球）
- 测试课程流程

---

## 附录

### A. 参考文档

- phase1_产品定位.md
- phase2_教学体系设计.md
- phase3_技术方案与系统架构.md
- phase4_AppStore合规与产品要求.md
- phase5_V1范围与路线图.md
- phase6_详细执行计划.md
- 代码库总结.md

### B. 关键联系人

| 角色 | 姓名 | 联系方式 |
|------|------|---------|
| 产品负责人 | [待填写] | [待填写] |
| 技术负责人 | [待填写] | [待填写] |
| UI设计师 | [待填写] | [待填写] |

### C. 重要链接

- GitHub仓库: [待填写]
- TestFlight链接: [待填写]
- App Store Connect: https://appstoreconnect.apple.com
- 隐私政策URL: [待填写]

---

**文档版本**: v1.0
**最后更新**: 2026-01-31
**下次评审**: 每周一


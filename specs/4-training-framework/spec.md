# 功能规格：训练场框架

**Feature Branch**: `4-training-framework`
**Created**: 2026-02-20
**Status**: 已完成 (回溯记录)

## 用户场景与测试

### 用户故事 1 - 浏览训练场列表 (Priority: P1)

用户进入训练 Tab 后，查看所有可用的训练场，了解每个训练场的类型、难度等级和解锁状态。

**验收场景**:

1. **Given** 用户进入训练页面, **When** 页面加载完成, **Then** 显示所有训练场列表（瞄准、杆法、翻袋、K球、传球、解球、颗星）
2. **Given** 某训练场需要付费解锁, **When** 用户查看列表, **Then** 该训练场显示锁定状态

---

### 用户故事 2 - 查看训练详情与选择难度 (Priority: P1)

用户点击训练场后进入详情页，选择难度等级（1-5星），查看最佳记录，开始训练。

**验收场景**:

1. **Given** 用户点击已解锁的训练场, **When** 进入详情页, **Then** 显示 5 个难度等级、历史最佳记录
2. **Given** 用户选择难度等级, **When** 点击开始训练, **Then** 进入全屏训练场景

---

### 用户故事 3 - 执行训练与交互 (Priority: P1)

用户在训练场景中完成击球操作，包括瞄准、选择打点、控制力度、执行击球，并获得实时反馈。

**验收场景**:

1. **Given** 用户进入训练场景, **When** 拖拽调整瞄准方向, **Then** 瞄准线实时更新
2. **Given** 用户选择打点和力度, **When** 松手击球, **Then** 物理引擎计算并播放球运动轨迹
3. **Given** 训练有时间限制, **When** 训练进行中, **Then** 计时器实时显示

---

### 用户故事 4 - 训练结果与星级评价 (Priority: P2)

训练结束后，用户查看得分、进球率、用时等统计，获得 1-5 星评价。

**验收场景**:

1. **Given** 训练结束, **When** 结算页面显示, **Then** 展示得分、进球数、用时、星级
2. **Given** 用户获得新的最佳记录, **When** 结算时, **Then** 显示"新纪录"标识

---

## 需求

### 功能需求

- **FR-001**: 系统 MUST 提供 TrainingListView 展示所有训练场类型与解锁状态
- **FR-002**: 系统 MUST 提供 TrainingDetailView 展示训练场难度选择与最佳记录
- **FR-003**: 系统 MUST 提供 TrainingSceneView 全屏训练场景
- **FR-004**: 系统 MUST 提供 PowerGaugeView 力度控制组件
- **FR-005**: 系统 MUST 提供 CuePointSelectorView 打点选择组件
- **FR-006**: 系统 MUST 通过 TrainingViewModel 管理训练状态（得分、计时、星级）
- **FR-007**: 系统 MUST 通过 TrainingConfig 定义训练场配置（球位、目标、通过条件）
- **FR-008**: 系统 MUST 支持 1-5 星难度等级评价
- **FR-009**: 系统 MUST 记录训练会话数据（TrainingSession）
- **FR-010**: 系统 MUST 将训练场景与物理引擎（EventDrivenEngine）集成

### 关键实体

- **TrainingConfig**: 训练场类型、难度、球位布局、目标条件、时间限制
- **TrainingViewModel**: 训练状态管理、得分计算、星级评定
- **TrainingSession**: 训练记录（类型、开始/结束时间、得分、击球记录）

## 成功标准

- **SC-001**: 训练场景加载时间 < 2 秒
- **SC-002**: 力度条和打点选择器响应延迟 < 100ms
- **SC-003**: 击球后物理模拟与视觉回放流畅（60fps）
- **SC-004**: 星级评价逻辑与训练配置的通过条件一致
- **SC-005**: 训练会话数据正确持久化到 SwiftData
